<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Standalone action & menu -->
    <record id="action_pps_schedule" model="ir.actions.act_window">
        <field name="name">ตารางรับชำระเงิน</field>
        <field name="res_model">pps.schedule</field>
        <field name="view_mode">list,form</field>
        <field name="context">{}</field>
        <field name="domain">[]</field>
    </record>

    <menuitem id="menu_pps_root" name="ตารางรับชำระเงิน" parent="base.menu_config"
        action="action_pps_schedule" sequence="90" />

    <!-- List View -->
    <record id="view_pps_schedule_tree" model="ir.ui.view">
        <field name="name">pps.schedule.tree</field>
        <field name="model">pps.schedule</field>
        <field name="arch" type="xml">
            <list string="ตารางรับชำระเงิน">
                <field name="partner_display_name" string="พาร์ทเนอร์" />
                <field name="name" />
                <field name="mode" />
                <field name="dom_everyday" invisible="mode != 'dom'" />
                <field name="dom_day_ids" widget="many2many_tags" invisible="mode != 'dom'" />
                <field name="dow_weekday_ids" widget="many2many_tags" invisible="mode != 'dow'" />
                <field name="week_rule" invisible="mode != 'dow'" />
                <field name="time_float" widget="float_time" />
                <field name="next_run" />
                <field name="active" />
            </list>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_pps_schedule_form" model="ir.ui.view">
        <field name="name">pps.schedule.form</field>
        <field name="model">pps.schedule</field>
        <field name="arch" type="xml">
            <form string="ตารางรับชำระเงิน">
                <sheet>
                    <group>
                        <group>
                            <field name="partner_id" />
                            <field name="active" />
                            <field name="mode" />
                        </group>
                        <group>
                            <field name="name" readonly="1" />
                            <field name="time_float" widget="float_time" />
                            <field name="next_run" readonly="1" />
                            <field name="description" />
                        </group>
                    </group>

                    <separator string="ตั้งค่าตามโหมด" />
                    <group invisible="mode != 'dom'">
                        <group string="ระบุวันที่" colspan="4">
                            <field name="dom_everyday" />
                            <field name="dom_day_ids" widget="many2many_tags"
                                options="{'no_create': True}" invisible="dom_everyday == True" />
                            <div
                                class="o_form_label o_form_label_muted"
                                invisible="dom_everyday == True">
                                เคล็ดลับ: เลือกได้หลายวัน (เช่น 1, 15, 30)
                                เพื่อให้ตรงกับรอบการวางบิลของคุณ
                            </div>
                        </group>
                    </group>

                    <group invisible="mode != 'dow'">
                        <group string="ระบุวันในสัปดาห์" colspan="4">
                            <field name="dow_weekday_ids" widget="many2many_tags"
                                options="{'no_create': True}" />
                            <field name="week_rule" />
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_pps_schedule_search" model="ir.ui.view">
        <field name="name">pps.schedule.search</field>
        <field name="model">pps.schedule</field>
        <field name="arch" type="xml">
            <search>
                <field name="partner_id" />
                <filter name="mode_dom" string="แบบระบุวันที่" domain="[('mode','=','dom')]" />
                <filter name="mode_dow" string="แบบระบุวันในสัปดาห์" domain="[('mode','=','dow')]" />
                <filter name="active" string="ใช้งานอยู่" domain="[('active','=',True)]" />
            </search>
        </field>
    </record>

    <!-- Inherit Partner form -->
    <record id="view_partner_form_inherit_pps" model="ir.ui.view">
        <field name="name">res.partner.form.inherit.pps</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form" />
        <field name="arch" type="xml">
            <xpath expr="//page[@name='accounting']" position="inside">
                <group string="ตารางรับชำระเงิน (Customer Payment)" name="pps_group" colspan="4">
                    <field name="pps_schedule_ids" context="{'default_schedule_type': 'payment'}">
                        <list editable="bottom" decoration-muted="not active" delete="true">
                            <field name="name" readonly="1" />
                            <field name="mode" />
                            <field name="dom_everyday" invisible="mode != 'dom'" />
                            <field name="dom_day_ids" widget="many2many_tags"
                                invisible="mode != 'dom'" />
                            <field name="dow_weekday_ids" widget="many2many_tags"
                                invisible="mode != 'dow'" />
                            <field name="week_rule" invisible="mode != 'dow'" />
                            <field name="time_float" widget="float_time" />
                            <field name="next_run" readonly="1" />
                            <field name="active" />
                        </list>
                        <form string="ตารางรับชำระเงิน">
                            <sheet>
                                <group>
                                    <group>
                                        <field name="schedule_type" invisible="1" />
                                        <field name="mode" />
                                        <field name="name" readonly="1" />
                                        <field name="time_float" widget="float_time" />
                                        <field name="next_run" readonly="1" />
                                    </group>
                                    <group>
                                        <field name="description" />
                                        <field name="active" />
                                    </group>
                                </group>
                                <group invisible="mode != 'dom'">
                                    <group string="ระบุวันที่" colspan="4">
                                        <field name="dom_everyday" />
                                        <field name="dom_day_ids" widget="many2many_tags"
                                            options="{'no_create': True}"
                                            invisible="dom_everyday == True" />
                                    </group>
                                </group>
                                <group invisible="mode != 'dow'">
                                    <group string="ระบุวันในสัปดาห์" colspan="4">
                                        <field name="dow_weekday_ids" widget="many2many_tags"
                                            options="{'no_create': True}" />
                                        <field name="week_rule" />
                                    </group>
                                </group>
                            </sheet>
                        </form>
                    </field>
                </group>

                <group string="ตารางวางบิล (Customer Billing)" name="pps_billing_group" colspan="4">
                    <field name="pps_billing_schedule_ids"
                        context="{'default_schedule_type': 'billing'}">
                        <list editable="bottom" decoration-muted="not active" delete="true">
                            <field name="name" readonly="1" />
                            <field name="mode" />
                            <field name="dom_everyday" invisible="mode != 'dom'" />
                            <field name="dom_day_ids" widget="many2many_tags"
                                invisible="mode != 'dom'" />
                            <field name="dow_weekday_ids" widget="many2many_tags"
                                invisible="mode != 'dow'" />
                            <field name="week_rule" invisible="mode != 'dow'" />
                            <field name="time_float" widget="float_time" />
                            <field name="next_run" readonly="1" />
                            <field name="active" />
                        </list>
                        <form string="ตารางวางบิล">
                            <sheet>
                                <group>
                                    <group>
                                        <field name="schedule_type" invisible="1" />
                                        <field name="mode" />
                                        <field name="name" readonly="1" />
                                        <field name="time_float" widget="float_time" />
                                        <field name="next_run" readonly="1" />
                                    </group>
                                    <group>
                                        <field name="description" />
                                        <field name="active" />
                                    </group>
                                </group>
                                <group invisible="mode != 'dom'">
                                    <group string="ระบุวันที่" colspan="4">
                                        <field name="dom_everyday" />
                                        <field name="dom_day_ids" widget="many2many_tags"
                                            options="{'no_create': True}"
                                            invisible="dom_everyday == True" />
                                    </group>
                                </group>
                                <group invisible="mode != 'dow'">
                                    <group string="ระบุวันในสัปดาห์" colspan="4">
                                        <field name="dow_weekday_ids" widget="many2many_tags"
                                            options="{'no_create': True}" />
                                        <field name="week_rule" />
                                    </group>
                                </group>
                            </sheet>
                        </form>
                    </field>
                </group>
            </xpath>
        </field>
    </record>

</odoo>
